# 目标文件（.o文件）

注：从嵌入式课本中摘抄，可能有错

## 组成

目标文件由三部分组成：
1. 代码段（.text/.code段，只读）：由代码部分生成的二进制机器码
2. 只读数据段（.rodata段，read-only data）：由程序中使用的常量组成，即全局常量和字符串常量
3. 读写数据段（.data段，RW data）：已初始化的静态变量，未初始化（未赋初值的定义）的静态变量不在其中

代码在运行时会再产生两个段：
1. .bss段（Block Started by Symbol segment）：未初始化的静态变量。在目标文件中，未初始化的静态变量只会被标识其内存分配的信息，然后在运行时产生.bss段来存储。
2. 堆栈段：分为栈区和堆区
    1. 栈区（stack）：又称堆栈，用来存放：
        1. 函数中没有被static声明的变量，即动态变量/局部变量
        2. 函数调用时被现场保护的参数
        3. 函数的返回值
    2. 堆区（heap）：用于存放进程运行中被动态分配的数据内存段。**与数据结构中的堆不是一个东西**。一般由程序员分配和释放（malloc/calloc/recalloc/free等），程序执行完毕后，未被释放的内存由操作系统释放。

## 链接

将各.o文件的代码段、RO data段、RW data段拆开，然后各自分类组合，就得到了.exe文件。.exe文件的某一段由所有.o文件的某一段合并而来

## 运行

内存中静态区在最前面，剩下的都作为动态区在后面

### .exe内机器码

.exe内机器码会被加载到静态区，有下面两种可能：

1. 全部加载到内存中运行，执行速度快但占用内存多
2. 只将RW data段加载到内存中，因为要从ROM中读取代码，执行速度稍慢但节省内存

### 运行时初始化的数据

1. bss段，放在静态区最后面
2. heap，放在动态区最前面
3. stack，放在动态区最后面
